<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gitly â€“ AI-Powered GitHub Dashboard</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

  <style>
    :root {
      --bg-color: #0d1117;
      --text-color: #c9d1d9;
      --input-bg: #161b22;
      --input-border: #30363d;
      --btn-primary: #2d72d2;
      --btn-primary-hover: #1f6feb;
      --btn-success: #238636;
      --btn-success-hover: #2ea043;
      --card-bg: #161b22;
      --card-border: #30363d;
      --icon-bg: rgba(45, 114, 210, 0.2);
      --icon-color: #2d72d2;
      --placeholder-color: #8b949e;
      --footer-color: #a0aec0;
      --spinner-border-color: #ffffff55;
      --spinner-top-border-color: white;
      --flash-info-bg: #1a202b;
      --flash-info-text: #58a6ff;
      --flash-info-border: #58a6ff;
      --flash-success-bg: #1a2b1a;
      --flash-success-text: #238636;
      --flash-success-border: #238636;
      --flash-error-bg: #2b1a1a;
      --flash-error-text: #ff7b72;
      --flash-error-border: #ff7b72;
    }

    body.light-mode {
      --bg-color: #f8f9fa;
      --text-color: #212529;
      --input-bg: #fff;
      --input-border: #ced4da;
      --btn-primary: #0d6efd;
      --btn-primary-hover: #0b5ed7;
      --btn-success: #198754;
      --btn-success-hover: #157347;
      --card-bg: #fff;
      --card-border: #e9ecef;
      --icon-bg: rgba(13, 110, 253, 0.1);
      --icon-color: #0d6efd;
      --placeholder-color: #6c757d;
      --footer-color: #6c757d;
      --spinner-border-color: #00000022;
      --spinner-top-border-color: #0d6efd;
      --flash-info-bg: #e0f2ff;
      --flash-info-text: #0d6efd;
      --flash-info-border: #9ec5fe;
      --flash-success-bg: #d1e7dd;
      --flash-success-text: #0f5132;
      --flash-success-border: #badbcc;
      --flash-error-bg: #f8d7da;
      --flash-error-text: #842029;
      --flash-error-border: #f5c2c7;
    }

    body {
      margin: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      text-align: center;
      transition: all 0.4s ease;
      background-image: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.02), transparent 60%);
      background-attachment: fixed;
    }
    
    .btn {
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease, border-color 0.2s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    body.light-mode .btn:hover {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .form-control {
      max-width: 400px;
      margin: 20px auto; 
      background-color: var(--input-bg);
      color: var(--text-color);
      border: 1px solid var(--input-border);
    }

    .form-control::placeholder {
      color: var(--placeholder-color);
    }

    .form-control:focus {
      border-color: var(--btn-primary);
      box-shadow: none;
      background-color: var(--input-bg);
      color: var(--text-color);
      outline: none;
    }

    body.light-mode .form-control:focus {
      box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    .btn-success {
      background-color: var(--btn-success);
      border: none;
      color: var(--text-color);
      box-shadow: none;
    }

    .btn-success:hover,
    .btn-success:focus,
    .btn-success:active,
    .btn-success:focus:active {
      background-color: var(--btn-success-hover);
      color: var(--text-color);
      box-shadow: none;
      outline: none;
    }

    .btn-primary {
      background-color: var(--btn-primary);
      border: none;
    }

    .btn-primary:hover {
      background-color: var(--btn-primary-hover);
    }

    .btn-outline-primary {
      color: var(--btn-primary);
      border-color: var(--btn-primary);
    }

    .btn-outline-primary:hover {
      background-color: var(--btn-primary);
      color: white;
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid var(--spinner-border-color);
      border-top: 3px solid var(--spinner-top-border-color);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to {
          transform: rotate(360deg);
      }
    }
    .hidden {
      display: none;
    }

    /* Custom style for theme switch button */
    #theme-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }

    #theme-btn button {
      display: flex;
      align-items: center;
      gap: 6px;
      border-radius: 0.5rem;
      background-color: transparent;
      font-weight: 500;
      color: var(--text-color);
      border-color: var(--input-border);
      transition: all 0.2s ease-in-out;
      cursor: pointer;
      padding: 0.5rem 1rem;
    }

    #theme-btn button:hover {
      background-color: var(--card-bg);
      color: var(--btn-primary);
      border-color: var(--btn-primary);
      box-shadow: 0 0 0 2px rgba(45, 114, 210, 0.2);
    }

    /* Hide the text on smaller screens */
    @media (max-width: 768px) {
      #theme-btn .theme-text {
        display: none;
      }
      #theme-btn button {
        padding: 0.5rem;
      }
      #theme-btn {
        top: 10px;
        right: 10px;
      }
    }

    footer {
      font-size: 0.9rem;
      margin-top: auto;
      color: var(--footer-color);
    }

    /* Original 'hidden' class for visibility animation */
    .initial-hidden { visibility: hidden; }
    .show { visibility: visible; }

    #g-letter, #itly-word {
      font-family: 'Times New Roman', Times, serif;
      color: #2f81f7;
      font-weight: bold;
      font-size: 4rem;
      text-shadow:
        1px 1px 0px rgba(0, 0, 0, 0.4),
        2px 2px 0px rgba(0, 0, 0, 0.4),
        3px 3px 0px rgba(0, 0, 0, 0.4),
        4px 4px 0px rgba(0, 0, 0, 0.4),
        5px 5px 0px rgba(0, 0, 0, 0.4),
        6px 6px 8px rgba(0, 0, 0, 0.7);
    }

    body.light-mode #g-letter,
    body.light-mode #itly-word {
      text-shadow:
        1px 1px 0px rgba(0, 0, 0, 0.1),
        2px 2px 0px rgba(0, 0, 0, 0.1),
        3px 3px 0px rgba(0, 0, 0, 0.1),
        4px 4px 0px rgba(0, 0, 0, 0.1),
        5px 5px 0px rgba(0, 0, 0, 0.1),
        6px 6px 8px rgba(0, 0, 0, 0.4);
    }

    #g-letter {
      animation: zoomPulse 0.6s ease-in-out forwards;
      opacity: 0;
    }

    @keyframes zoomPulse {
      0% { transform: scale(0.2); opacity: 0; }
      60% { transform: scale(1.3); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    #itly-word {
      transform-origin: left;
      opacity: 0;
      animation: slideFromG 0.8s ease-in-out forwards;
      animation-delay: 0.7s;
    }

    @keyframes slideFromG {
      0% { transform: translateX(-20px) scaleX(0.1); opacity: 0; }
      100% { transform: translateX(0) scaleX(1); opacity: 1; }
    }

    .logo-container {
      display: flex;
      justify-content: center;
      align-items: baseline;
      gap: 5px;
      position: relative; 
      padding-bottom: 5px;
    }

    .logo-container::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 5px; 
      background: linear-gradient(
        to right,
        rgba(45, 114, 210, 0),
        rgba(45, 114, 210, 0.5), 
        rgba(45, 114, 210, 0)
      );
      box-shadow: none; 
      background-size: 200% 100%;
      animation: gradientLineAnimation 4s linear infinite;
    }

    @keyframes gradientLineAnimation {
      0% { background-position: -100% 0; }
      100% { background-position: 100% 0; }
    }
    
    #loader {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background-color: var(--bg-color);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }

    #main-content {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
      padding-top: 5rem; 
      flex-grow: 1;
    }

    /* Flash Messages Styling */
    .flash-messages-container {
      position: absolute;
      top: 20px; 
      width: 100%;
      display: flex;
      justify-content: center;
      z-index: 10;
    }

    .flash-message {
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 1.5rem;
      text-align: center;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      opacity: 1;
      transition: opacity 0.5s ease-out;
    }

    .flash-message.error {
      background-color: var(--flash-error-bg);
      color: var(--flash-error-text);
      border: 1px solid var(--flash-error-border);
    }

    .flash-message.success {
      background-color: var(--flash-success-bg);
      color: var(--flash-success-text);
      border: 1px solid var(--flash-success-border);
    }

    .flash-message.info {
      background-color: var(--flash-info-bg);
      color: var(--flash-info-text);
      border: 1px solid var(--flash-info-border);
    }

    /* Styles for the new feature cards */
    .feature-card {
      background-color: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 0.75rem;
      padding: 1.5rem; 
      text-align: left;
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      box-shadow: 0 4-6px rgba(0,0,0,0.1);
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    .feature-card:hover {
      transform: translateY(-0.5rem);
      border-color: var(--btn-primary);
      box-shadow: 0 8px 12px rgba(0,0,0,0.2);
    }
    .feature-card .icon-container {
      background-color: var(--icon-bg);
      width: 4rem; 
      height: 4rem; 
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 50%;
      margin-bottom: 1rem; 
    }
    .feature-card .icon-container i {
      font-size: 2rem; 
      color: var(--icon-color);
    }
    .feature-card h5 {
      font-weight: 600;
      margin-bottom: 0.5rem; 
    }
    .feature-card p {
      color: var(--footer-color);
      margin-bottom: 0;
    }
    body.light-mode .feature-card p {
      color: var(--footer-color);
    }
  </style>
</head>
<body>

  <div id="loader">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
  </div>

  <div id="main-content">
    <div class="position-absolute top-0 end-0 m-3" id="theme-btn">
      <button class="btn btn-outline-primary" onclick="toggleTheme()">
        <span class="theme-icon">ðŸŒ—</span>
        <span class="theme-text">Switch Theme</span>
      </button>
    </div>

    <div class="flash-messages-container" id="flash-messages-container">
      <!-- Flash messages will be dynamically added here by JavaScript or server-side rendering -->
    </div>

    <div class="logo-container mb-2">
      <h1 id="g-letter">G</h1>
      <h1 id="itly-word">itly</h1>
    </div>

    <h5 id="subtitle" class="animate__animated initial-hidden">Your Personal AI-powered GitHub Manager</h5>
    <p id="description" class="animate__animated initial-hidden">
      Access public GitHub profiles or sign in to view your private repositories.
    </p>

    {# Form for "View Public Repos" #}
    <form action="/" method="POST" id="search-form" class="animate__animated initial-hidden w-100 px-3">
      <input type="text" name="username" class="form-control" placeholder="Search GitHub username">
      <button type="submit" id="view-public-repos-btn" class="btn btn-success mt-3 d-flex align-items-center justify-content-center gap-2" style="max-width: 400px; margin: 0 auto;">
        <span id="btn-text">View Public Repos</span>
        <div id="loading-spinner" class="spinner hidden"></div>
      </button>
    </form>

    <p id="or-text" class="animate__animated initial-hidden mt-3">or</p>

    {# Link for "Sign in with GitHub" #}
    <div id="github-btn" class="animate__animated initial-hidden">
      <a href="{{ url_for('login') }}" class="btn btn-primary">
        <i class="bi bi-github" aria-hidden="true"></i> Sign in with GitHub
      </a>
    </div>

    {# New Features Section #}
    <section class="container mt-5 animate__animated initial-hidden" id="features-section">
      <div class="row g-4">
        
        <div class="col-12 col-md-4">
          <div class="feature-card">
            <div class="icon-container">
              <i class="bi bi-search"></i>
            </div>
            <h5>Live Repo Filtering</h5>
            <p>Find what you need instantly with real-time filtering and dynamic updates.</p>
          </div>
        </div>

        <div class="col-12 col-md-4">
          <div class="feature-card">
            <div class="icon-container">
              <i class="bi bi-stars"></i>
            </div>
            <h5>AI-powered Analytics</h5>
            <p>Gain deep insights into your projects with AI-powered analytics for code trends, and project health.</p>
          </div>
        </div>

        <div class="col-12 col-md-4">
          <div class="feature-card">
            <div class="icon-container">
              <i class="bi bi-graph-up"></i>
            </div>
            <h5>Language Trends</h5>
            <p>Visualize code language percentages and see usage trends over time.</p>
          </div>
        </div>

      </div>
    </section>
  </div>

  <footer id="footer" class="text-muted animate__animated initial-hidden">
    Â© 2025 Gitly
  </footer>

  <script>
    const sleep = ms => new Promise(res => setTimeout(res, ms));

    /**
     * Creates and displays a flash message.
     * @param {string} message - The message to display.
     * @param {string} category - The category of the message (e.g., 'info', 'success', 'error').
     */
    const displayFlashMessage = (message, category) => {
      const container = document.getElementById('flash-messages-container');
      const messageDiv = document.createElement('div');
      messageDiv.className = `flash-message ${category} mb-2`;
      messageDiv.textContent = message;
      container.appendChild(messageDiv);

      setTimeout(() => {
        messageDiv.style.opacity = '0';
        messageDiv.addEventListener('transitionend', () => messageDiv.remove());
      }, 1500);
    };

    const startMainContent = async () => {
      document.getElementById("loader").style.opacity = 0;
      await sleep(500);
      document.getElementById("loader").style.display = "none";
      const main = document.getElementById("main-content");
      main.style.display = "flex";

      await sleep(500);
      const ids = [
        "subtitle", "description", "search-form", 
        "or-text", "github-btn", "features-section", "footer"
      ];
      await sleep(1500);
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.classList.remove("initial-hidden"); 
            el.classList.add("animate__fadeInUp", "show");
        }
      });
    };

    window.addEventListener("load", () => {
      setTimeout(startMainContent, 2000);
    });

    document.addEventListener("DOMContentLoaded", () => {
      // Apply saved theme on load
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light-mode') {
        document.body.classList.add('light-mode');
      } else {
        document.body.classList.remove('light-mode');
      }

      // Check for 'logged_out' and 'logged_in' URL parameters and display flash messages
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('logged_out') === 'true') {
        displayFlashMessage('You have been logged out.', 'info');
      } else if (urlParams.get('logged_in') === 'true') {
        displayFlashMessage('Successfully logged in with GitHub!', 'success');
      }

      // Spinner logic for "View Public Repos" button
      const searchForm = document.getElementById("search-form");
      const viewPublicReposBtn = document.getElementById("view-public-repos-btn");
      const btnText = document.getElementById("btn-text"); 
      const loadingSpinner = document.getElementById("loading-spinner");

      if (searchForm && viewPublicReposBtn && btnText && loadingSpinner) {
        searchForm.addEventListener("submit", function () {
          viewPublicReposBtn.disabled = true;
          btnText.classList.add("hidden");
          loadingSpinner.classList.remove("hidden");
        });
      }
    });

    function toggleTheme() {
      const body = document.body;
      body.classList.toggle('light-mode');
      localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light-mode' : 'dark-mode');
    }
  </script>

</body>
</html>
